<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Behavior Design Review</title>
  <style>
    /* CSS Variables - Design System */
    :root {
      /* Light Theme */
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --bg-tertiary: #f1f3f4;
      --bg-hover: #e8eaed;
      --accent-primary: #6366f1;
      --accent-primary-hover: #818cf8;
      --accent-secondary: #22c55e;
      --accent-warning: #f59e0b;
      --accent-error: #ef4444;
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --text-muted: #9ca3af;
      --border-color: #e5e7eb;
      --card-bg: #ffffff;
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    /* Dark Theme */
    [data-theme="dark"] {
      --bg-primary: #1a1a1f;
      --bg-secondary: #25252b;
      --bg-tertiary: #2d2d35;
      --bg-hover: #35353d;
      --text-primary: #ffffff;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --border-color: #3f3f46;
      --card-bg: #25252b;
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    /* Common variables */
    :root,
    [data-theme="dark"] {
      --border-radius: 12px;
      --border-radius-sm: 8px;
      --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Reset & Base */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
      transition: var(--transition);
    }

    /* App Container */
    .app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      padding: 16px 20px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
      font-weight: 700;
      background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-title .icon {
      font-size: 20px;
    }

    .header-controls {
      display: flex;
      gap: 8px;
    }

    .control-btn {
      width: 36px;
      height: 36px;
      border-radius: var(--border-radius-sm);
      border: 1px solid var(--border-color);
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      transition: var(--transition);
    }

    .control-btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
      border-color: var(--accent-primary);
    }

    .control-btn.active {
      background: var(--accent-primary);
      color: white;
      border-color: var(--accent-primary);
    }

    /* Language Toggle */
    .lang-toggle {
      display: flex;
      background: var(--bg-tertiary);
      border-radius: 20px;
      padding: 2px;
      border: 1px solid var(--border-color);
    }

    .lang-btn {
      padding: 4px 10px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 11px;
      font-weight: 600;
      border-radius: 18px;
      cursor: pointer;
      transition: var(--transition);
    }

    .lang-btn.active {
      background: var(--accent-primary);
      color: white;
    }

    .lang-btn:hover:not(.active) {
      color: var(--text-primary);
    }

    /* Progress Steps */
    .progress-bar {
      display: flex;
      justify-content: center;
      gap: 8px;
      padding: 14px 20px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
    }

    .progress-step {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--bg-tertiary);
      transition: var(--transition);
    }

    .progress-step.active {
      background: var(--accent-primary);
      box-shadow: 0 0 12px rgba(99, 102, 241, 0.5);
    }

    .progress-step.completed {
      background: var(--accent-secondary);
    }

    /* Main Content */
    .content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    /* Step Containers */
    .step {
      display: none;
      animation: fadeIn 0.3s ease-out;
    }

    .step.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Step Header */
    .step-header {
      margin-bottom: 20px;
    }

    .step-number {
      display: inline-block;
      padding: 4px 10px;
      background: var(--accent-primary);
      border-radius: 20px;
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      margin-bottom: 8px;
      color: white;
    }

    .step-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 6px;
      color: var(--text-primary);
    }

    .step-description {
      color: var(--text-secondary);
      font-size: 13px;
    }

    /* Selection Card */
    .selection-card {
      background: var(--card-bg);
      border: 2px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 24px;
      text-align: center;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }

    .selection-card.has-selection {
      border-color: var(--accent-secondary);
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.08) 0%, var(--card-bg) 100%);
    }

    .selection-icon {
      font-size: 40px;
      margin-bottom: 12px;
    }

    .selection-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 6px;
    }

    .selection-value {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .selection-hint {
      margin-top: 12px;
      font-size: 12px;
      color: var(--text-secondary);
    }

    /* Criteria List */
    .criteria-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .criteria-label {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .select-all-toggle {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 5px 10px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      cursor: pointer;
      transition: var(--transition);
      font-size: 11px;
      color: var(--text-secondary);
    }

    .select-all-toggle:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .criteria-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .criterion-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-sm);
      padding: 14px;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: flex-start;
      gap: 12px;
      box-shadow: var(--shadow-sm);
    }

    .criterion-card:hover {
      background: var(--bg-hover);
      border-color: var(--accent-primary);
    }

    .criterion-card.selected {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, var(--card-bg) 100%);
      border-color: var(--accent-primary);
    }

    .criterion-checkbox {
      width: 18px;
      height: 18px;
      border: 2px solid var(--border-color);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
      flex-shrink: 0;
      margin-top: 2px;
    }

    .criterion-card.selected .criterion-checkbox {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
    }

    .criterion-checkbox::after {
      content: '‚úì';
      font-size: 11px;
      color: white;
      opacity: 0;
      transition: var(--transition);
    }

    .criterion-card.selected .criterion-checkbox::after {
      opacity: 1;
    }

    .criterion-content {
      flex: 1;
    }

    .criterion-name {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 13px;
      color: var(--text-primary);
    }

    .info-icon {
      width: 16px;
      height: 16px;
      background: var(--bg-tertiary);
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
      color: var(--text-muted);
      cursor: help;
      position: relative;
    }

    .info-icon:hover .tooltip {
      opacity: 1;
      visibility: visible;
      transform: translateX(0);
    }

    .tooltip {
      position: absolute;
      left: 24px;
      top: 50%;
      transform: translateY(-50%) translateX(-10px);
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 6px 10px;
      font-size: 11px;
      color: var(--text-secondary);
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
      z-index: 100;
      box-shadow: var(--shadow);
    }

    .criterion-description {
      font-size: 12px;
      color: var(--text-secondary);
    }

    /* Custom Context Section */
    .custom-context {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
    }

    .custom-context-toggle {
      display: flex;
      align-items: center;
      gap: 6px;
      background: none;
      border: none;
      color: var(--accent-primary);
      cursor: pointer;
      font-size: 13px;
      padding: 0;
      transition: var(--transition);
    }

    .custom-context-toggle:hover {
      color: var(--accent-primary-hover);
    }

    .custom-context-content {
      margin-top: 12px;
      display: none;
    }

    .custom-context-content.open {
      display: block;
      animation: fadeIn 0.3s ease-out;
    }

    .context-input {
      width: 100%;
      min-height: 70px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-sm);
      padding: 10px;
      color: var(--text-primary);
      font-family: inherit;
      font-size: 13px;
      resize: vertical;
      transition: var(--transition);
    }

    .context-input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }

    .context-input::placeholder {
      color: var(--text-muted);
    }

    /* Loading Step */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 280px;
      text-align: center;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid var(--bg-tertiary);
      border-top-color: var(--accent-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .loading-text {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text-primary);
    }

    .loading-subtext {
      font-size: 13px;
      color: var(--text-secondary);
    }

    /* Progress Bar */
    .progress-loader {
      width: 100%;
      max-width: 260px;
      height: 5px;
      background: var(--bg-tertiary);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 16px;
    }

    .progress-loader-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-primary-hover));
      border-radius: 3px;
      animation: progressFill 2s ease-out forwards;
    }

    @keyframes progressFill {
      from {
        width: 0%;
      }

      to {
        width: 100%;
      }
    }

    /* Suggestions List */
    .suggestions-container {
      max-height: 360px;
      overflow-y: auto;
      padding-right: 6px;
    }

    .suggestions-container::-webkit-scrollbar {
      width: 5px;
    }

    .suggestions-container::-webkit-scrollbar-track {
      background: var(--bg-secondary);
      border-radius: 3px;
    }

    .suggestions-container::-webkit-scrollbar-thumb {
      background: var(--bg-hover);
      border-radius: 3px;
    }

    .suggestion-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-sm);
      padding: 14px;
      margin-bottom: 10px;
      box-shadow: var(--shadow-sm);
    }

    .suggestion-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .suggestion-name {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      color: var(--text-primary);
    }

    .suggestion-score {
      padding: 3px 8px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
    }

    .score-high {
      background: rgba(34, 197, 94, 0.15);
      color: #22c55e;
    }

    .score-medium {
      background: rgba(245, 158, 11, 0.15);
      color: #f59e0b;
    }

    .score-low {
      background: rgba(239, 68, 68, 0.15);
      color: #ef4444;
    }

    .suggestion-issues {
      background: rgba(245, 158, 11, 0.08);
      border-radius: 6px;
      padding: 8px 10px;
      margin-bottom: 8px;
    }

    .suggestion-issues-label {
      font-size: 10px;
      font-weight: 600;
      color: var(--accent-warning);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }

    .suggestion-issues-list {
      list-style: none;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .suggestion-issues-list li {
      padding-left: 14px;
      position: relative;
      margin-bottom: 3px;
    }

    .suggestion-issues-list li::before {
      content: '‚Ä¢';
      position: absolute;
      left: 0;
      color: var(--accent-warning);
    }

    .suggestion-changes {
      background: rgba(34, 197, 94, 0.08);
      border-radius: 6px;
      padding: 8px 10px;
      margin-bottom: 8px;
    }

    .suggestion-changes-label {
      font-size: 10px;
      font-weight: 600;
      color: var(--accent-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }

    .suggestion-changes-list {
      list-style: none;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .suggestion-changes-list li {
      padding-left: 14px;
      position: relative;
      margin-bottom: 3px;
    }

    .suggestion-changes-list li::before {
      content: '‚úì';
      position: absolute;
      left: 0;
      color: var(--accent-secondary);
      font-size: 10px;
    }

    .suggestion-recommendations {
      background: rgba(99, 102, 241, 0.08);
      border-radius: 6px;
      padding: 8px 10px;
    }

    .suggestion-recommendations-label {
      font-size: 10px;
      font-weight: 600;
      color: var(--accent-primary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }

    .suggestion-recommendations-list {
      list-style: none;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .suggestion-recommendations-list li {
      padding-left: 14px;
      position: relative;
      margin-bottom: 3px;
    }

    .suggestion-recommendations-list li::before {
      content: '‚Üí';
      position: absolute;
      left: 0;
      color: var(--accent-primary);
    }

    /* Element Observations */
    .element-observations {
      background: rgba(99, 102, 241, 0.06);
      border-radius: 8px;
      padding: 10px 12px;
      margin-top: 8px;
    }

    .obs-label {
      font-size: 11px;
      font-weight: 600;
      color: var(--accent-primary);
      margin-bottom: 8px;
    }

    .obs-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .obs-item {
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      gap: 6px;
      padding: 8px 10px;
      margin-bottom: 6px;
      border-radius: 6px;
      font-size: 12px;
      line-height: 1.4;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
    }

    .obs-item:last-child {
      margin-bottom: 0;
    }

    .obs-item.obs-issue {
      border-left: 3px solid var(--accent-warning);
    }

    .obs-item.obs-suggestion {
      border-left: 3px solid var(--accent-primary);
    }

    .obs-element {
      display: inline-block;
      background: rgba(99, 102, 241, 0.12);
      color: var(--accent-primary);
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
      white-space: nowrap;
    }

    .obs-message {
      flex: 1;
      color: var(--text-secondary);
      min-width: 150px;
    }

    /* Skeleton Loading */
    .skeleton-container {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .skeleton-item {
      background: linear-gradient(90deg,
          var(--bg-secondary) 0%,
          var(--bg-tertiary) 50%,
          var(--bg-secondary) 100%);
      background-size: 200% 100%;
      border-radius: var(--border-radius-sm);
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% {
        background-position: 200% 0;
      }

      100% {
        background-position: -200% 0;
      }
    }

    .skeleton-header {
      height: 28px;
      width: 60%;
    }

    .skeleton-content {
      height: 100px;
    }

    .skeleton-row {
      height: 20px;
      width: 80%;
    }

    .skeleton-row-short {
      height: 20px;
      width: 50%;
    }

    /* Report Complete */
    .report-complete {
      text-align: center;
      padding: 30px 16px;
    }

    .success-icon {
      font-size: 56px;
      margin-bottom: 20px;
      animation: successPop 0.5s ease-out;
    }

    @keyframes successPop {
      0% {
        transform: scale(0);
        opacity: 0;
      }

      50% {
        transform: scale(1.2);
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .report-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 10px;
      color: var(--text-primary);
    }

    .report-description {
      color: var(--text-secondary);
      font-size: 13px;
      margin-bottom: 20px;
    }

    .report-stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 24px;
    }

    .report-stat {
      text-align: center;
      padding: 12px 16px;
      background: var(--bg-secondary);
      border-radius: var(--border-radius-sm);
      border: 1px solid var(--border-color);
    }

    .report-stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent-secondary);
    }

    .report-stat-label {
      font-size: 10px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Footer / Actions */
    .footer {
      padding: 16px 20px;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-color);
      display: flex;
      gap: 10px;
    }

    .btn {
      flex: 1;
      padding: 12px 16px;
      border: none;
      border-radius: var(--border-radius-sm);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-primary) 0%, #8b5cf6 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--accent-secondary) 0%, #16a34a 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);
    }

    /* Overall Score Display */
    .overall-score {
      background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 16px;
      text-align: center;
      margin-bottom: 20px;
    }

    .score-circle {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: conic-gradient(var(--accent-secondary) calc(var(--score) * 3.6deg),
          var(--bg-tertiary) 0);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      position: relative;
    }

    .score-circle::before {
      content: '';
      position: absolute;
      width: 64px;
      height: 64px;
      background: var(--bg-secondary);
      border-radius: 50%;
    }

    .score-value {
      position: relative;
      z-index: 1;
      font-size: 22px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .score-label {
      font-size: 12px;
      color: var(--text-secondary);
    }
  </style>
</head>

<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="header-title">
        <span class="icon">üß†</span>
        <span data-i18n="pluginName">Behavior Design Review</span>
      </div>
      <div class="header-controls">
        <div class="lang-toggle">
          <button class="lang-btn active" data-lang="en">EN</button>
          <button class="lang-btn" data-lang="es">ES</button>
        </div>
        <button class="control-btn" id="theme-toggle" title="Toggle theme">
          üåô
        </button>
      </div>
    </header>

    <!-- Progress Bar -->
    <div class="progress-bar">
      <div class="progress-step active" data-step="1"></div>
      <div class="progress-step" data-step="2"></div>
      <div class="progress-step" data-step="3"></div>
      <div class="progress-step" data-step="4"></div>
      <div class="progress-step" data-step="5"></div>
      <div class="progress-step" data-step="6"></div>
    </div>

    <!-- Main Content -->
    <main class="content">
      <!-- Step 1: Selection -->
      <section class="step active" id="step-1">
        <div class="step-header">
          <span class="step-number" data-i18n="step1Label">Step 1</span>
          <h2 class="step-title" data-i18n="step1Title">Select Target Frame</h2>
          <p class="step-description" data-i18n="step1Desc">Choose a frame to analyze for behavioral optimization
            opportunities.</p>
        </div>

        <div class="selection-card" id="selection-card">
          <div class="selection-icon" id="selection-icon">üìê</div>
          <div class="selection-label" data-i18n="target">Target</div>
          <div class="selection-value" id="selection-value" data-i18n="noSelection">No Selection</div>
          <p class="selection-hint" id="selection-hint" data-i18n="selectHint">Select a frame in Figma to continue</p>
        </div>
      </section>

      <!-- Step 2: Behavioral Criteria -->
      <section class="step" id="step-2">
        <div class="step-header">
          <span class="step-number" data-i18n="step2Label">Step 2</span>
          <h2 class="step-title" data-i18n="step2Title">Behavioral Criteria</h2>
          <p class="step-description" data-i18n="step2Desc">Select which behavioral heuristics to evaluate.</p>
        </div>

        <div class="criteria-header">
          <span class="criteria-label" data-i18n="selectCriteria">Select criteria to evaluate</span>
          <button class="select-all-toggle" id="select-all-btn">
            <span>‚úì</span> <span data-i18n="selectAll">Select All</span>
          </button>
        </div>

        <div class="criteria-list" id="criteria-list">
          <div class="criterion-card selected" data-criterion="fogg_ability">
            <div class="criterion-checkbox"></div>
            <div class="criterion-content">
              <div class="criterion-name">
                <span data-i18n="foggAbility">Fogg's Ability</span>
                <span class="info-icon">i
                  <span class="tooltip" data-i18n="foggTooltip">Based on BJ Fogg's Behavior Model</span>
                </span>
              </div>
              <p class="criterion-description" data-i18n="foggDesc">Minimize physical and cognitive effort for users</p>
            </div>
          </div>

          <div class="criterion-card selected" data-criterion="spark_triggers">
            <div class="criterion-checkbox"></div>
            <div class="criterion-content">
              <div class="criterion-name">
                <span data-i18n="sparkTriggers">Spark Triggers</span>
                <span class="info-icon">i
                  <span class="tooltip" data-i18n="sparkTooltip">Prompts for motivated users</span>
                </span>
              </div>
              <p class="criterion-description" data-i18n="sparkDesc">Clear calls to action for motivated users</p>
            </div>
          </div>

          <div class="criterion-card selected" data-criterion="scarcity_urgency">
            <div class="criterion-checkbox"></div>
            <div class="criterion-content">
              <div class="criterion-name">
                <span data-i18n="scarcityUrgency">Scarcity/Urgency</span>
                <span class="info-icon">i
                  <span class="tooltip" data-i18n="scarcityTooltip">Loss aversion psychology</span>
                </span>
              </div>
              <p class="criterion-description" data-i18n="scarcityDesc">Use of loss aversion to drive action</p>
            </div>
          </div>

          <div class="criterion-card selected" data-criterion="social_proof">
            <div class="criterion-checkbox"></div>
            <div class="criterion-content">
              <div class="criterion-name">
                <span data-i18n="socialProof">Social Proof</span>
                <span class="info-icon">i
                  <span class="tooltip" data-i18n="socialTooltip">Community validation influence</span>
                </span>
              </div>
              <p class="criterion-description" data-i18n="socialDesc">Influence through community validation</p>
            </div>
          </div>

          <div class="criterion-card selected" data-criterion="goal_gradient">
            <div class="criterion-checkbox"></div>
            <div class="criterion-content">
              <div class="criterion-name">
                <span data-i18n="goalGradient">Goal Gradient</span>
                <span class="info-icon">i
                  <span class="tooltip" data-i18n="goalTooltip">Progress motivation effect</span>
                </span>
              </div>
              <p class="criterion-description" data-i18n="goalDesc">Showing progress to increase completion rates</p>
            </div>
          </div>
        </div>

        <!-- Custom Context -->
        <div class="custom-context">
          <button class="custom-context-toggle" id="context-toggle">
            <span>+</span> <span data-i18n="addContext">Add Custom Context</span>
          </button>
          <div class="custom-context-content" id="context-content">
            <textarea class="context-input" id="custom-context-input" data-i18n-placeholder="contextPlaceholder"
              placeholder="Describe your specific use case, target audience, or any additional context for the analysis..."></textarea>
          </div>
        </div>
      </section>

      <!-- Step 3: Loading -->
      <section class="step" id="step-3">
        <div class="loading-container">
          <div class="spinner"></div>
          <div class="loading-text" data-i18n="processingAnalysis">Processing Analysis</div>
          <p class="loading-subtext" data-i18n="evaluatingPatterns">Evaluating behavioral patterns...</p>
          <div class="progress-loader">
            <div class="progress-loader-fill"></div>
          </div>
        </div>
      </section>

      <!-- Step 4: Suggestions -->
      <section class="step" id="step-4">
        <div class="step-header">
          <span class="step-number" data-i18n="step4Label">Step 4</span>
          <h2 class="step-title" data-i18n="step4Title">Behavioral Recommendations</h2>
          <p class="step-description" data-i18n="step4Desc">Review the analysis results and planned changes.</p>
        </div>

        <div class="overall-score" id="overall-score">
          <div class="score-circle" style="--score: 75;">
            <span class="score-value" id="score-value">75%</span>
          </div>
          <div class="score-label" data-i18n="overallScore">Overall Behavioral Score</div>
        </div>

        <div class="suggestions-container" id="suggestions-container">
          <!-- Suggestions will be dynamically inserted here -->
        </div>
      </section>

      <!-- Step 5: Skeleton Loading -->
      <section class="step" id="step-5">
        <div class="step-header">
          <span class="step-number" data-i18n="step5Label">Step 5</span>
          <h2 class="step-title" data-i18n="step5Title">Generating Report</h2>
          <p class="step-description" data-i18n="step5Desc">Creating optimized frame and behavioral report...</p>
        </div>

        <div class="skeleton-container">
          <div class="skeleton-item skeleton-header"></div>
          <div class="skeleton-item skeleton-content"></div>
          <div class="skeleton-item skeleton-row"></div>
          <div class="skeleton-item skeleton-row-short"></div>
          <div class="skeleton-item skeleton-content"></div>
          <div class="skeleton-item skeleton-row"></div>
        </div>
      </section>

      <!-- Step 6: Report Complete -->
      <section class="step" id="step-6">
        <div class="report-complete">
          <div class="success-icon">‚ú®</div>
          <h2 class="report-title" data-i18n="reportGenerated">Report Generated!</h2>
          <p class="report-description" data-i18n="reportDesc">
            Your behavioral analysis report has been created on the canvas.
          </p>

          <div class="report-stats" id="report-stats">
            <div class="report-stat">
              <div class="report-stat-value" id="criteria-count">5</div>
              <div class="report-stat-label" data-i18n="criteriaEvaluated">Criteria Evaluated</div>
            </div>
            <div class="report-stat">
              <div class="report-stat-value" id="changes-count">8</div>
              <div class="report-stat-label" data-i18n="changesApplied">Changes Applied</div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer" id="footer">
      <button class="btn btn-secondary" id="btn-back" style="display: none;">
        ‚Üê <span data-i18n="back">Back</span>
      </button>
      <button class="btn btn-primary" id="btn-next" disabled>
        <span data-i18n="next">Next</span> ‚Üí
      </button>
    </footer>
  </div>

  <script>
    // Translations
    const translations = {
      en: {
        pluginName: "Behavior Design Review",
        step1Label: "Step 1",
        step1Title: "Select Target Frame",
        step1Desc: "Choose a frame to analyze for behavioral optimization opportunities.",
        target: "Target",
        noSelection: "No Selection",
        selectHint: "Select a frame in Figma to continue",
        selectedHint: "Frame selected and ready for analysis",
        step2Label: "Step 2",
        step2Title: "Behavioral Criteria",
        step2Desc: "Select which behavioral heuristics to evaluate.",
        selectCriteria: "Select criteria to evaluate",
        selectAll: "Select All",
        deselectAll: "Deselect All",
        foggAbility: "Fogg's Ability",
        foggTooltip: "Based on BJ Fogg's Behavior Model",
        foggDesc: "Minimize physical and cognitive effort for users",
        sparkTriggers: "Spark Triggers",
        sparkTooltip: "Prompts for motivated users",
        sparkDesc: "Clear calls to action for motivated users",
        scarcityUrgency: "Scarcity/Urgency",
        scarcityTooltip: "Loss aversion psychology",
        scarcityDesc: "Use of loss aversion to drive action",
        socialProof: "Social Proof",
        socialTooltip: "Community validation influence",
        socialDesc: "Influence through community validation",
        goalGradient: "Goal Gradient",
        goalTooltip: "Progress motivation effect",
        goalDesc: "Showing progress to increase completion rates",
        addContext: "Add Custom Context",
        contextPlaceholder: "Describe your specific use case, target audience, or any additional context for the analysis...",
        processingAnalysis: "Processing Analysis",
        evaluatingPatterns: "Evaluating behavioral patterns...",
        step4Label: "Step 4",
        step4Title: "Behavioral Recommendations",
        step4Desc: "Review the analysis results and suggestions.",
        overallScore: "Overall Behavioral Score",
        issuesFound: "Issues Found",
        changesPlanned: "Suggested Improvements",
        suggestions: "Suggestions",
        step5Label: "Step 5",
        step5Title: "Adding Notes",
        step5Desc: "Creating suggestion notes on your frame...",
        reportGenerated: "Notes Added!",
        reportDesc: "Suggestion notes have been added next to your frame on the canvas.",
        criteriaEvaluated: "Criteria Evaluated",
        changesApplied: "Notes Created",
        back: "Back",
        next: "Next",
        evaluate: "Evaluate Behavior",
        applySuggestions: "Add Notes",
        done: "Done"
      },
      es: {
        pluginName: "Behavior Design Review",
        step1Label: "Paso 1",
        step1Title: "Seleccionar Frame",
        step1Desc: "Elige un frame para analizar oportunidades de optimizaci√≥n behavioral.",
        target: "Objetivo",
        noSelection: "Sin Selecci√≥n",
        selectHint: "Selecciona un frame en Figma para continuar",
        selectedHint: "Frame seleccionado y listo para analizar",
        step2Label: "Paso 2",
        step2Title: "Criterios Behavioral",
        step2Desc: "Selecciona qu√© heur√≠sticas behavioral evaluar.",
        selectCriteria: "Seleccionar criterios a evaluar",
        selectAll: "Seleccionar Todo",
        deselectAll: "Deseleccionar Todo",
        foggAbility: "Habilidad de Fogg",
        foggTooltip: "Basado en el Modelo de Comportamiento de BJ Fogg",
        foggDesc: "Minimizar esfuerzo f√≠sico y cognitivo para usuarios",
        sparkTriggers: "Disparadores Spark",
        sparkTooltip: "Motivadores para usuarios",
        sparkDesc: "Llamadas a la acci√≥n claras para usuarios motivados",
        scarcityUrgency: "Escasez/Urgencia",
        scarcityTooltip: "Psicolog√≠a de aversi√≥n a la p√©rdida",
        scarcityDesc: "Uso de aversi√≥n a la p√©rdida para impulsar acci√≥n",
        socialProof: "Prueba Social",
        socialTooltip: "Influencia por validaci√≥n de comunidad",
        socialDesc: "Influencia a trav√©s de validaci√≥n comunitaria",
        goalGradient: "Gradiente de Meta",
        goalTooltip: "Efecto de motivaci√≥n por progreso",
        goalDesc: "Mostrar progreso para aumentar tasas de completaci√≥n",
        addContext: "Agregar Contexto Personalizado",
        contextPlaceholder: "Describe tu caso de uso espec√≠fico, audiencia objetivo, o cualquier contexto adicional para el an√°lisis...",
        processingAnalysis: "Procesando An√°lisis",
        evaluatingPatterns: "Evaluando patrones behavioral...",
        step4Label: "Paso 4",
        step4Title: "Recomendaciones Behavioral",
        step4Desc: "Revisa los resultados del an√°lisis y sugerencias.",
        overallScore: "Puntuaci√≥n Behavioral General",
        issuesFound: "Problemas Encontrados",
        changesPlanned: "Mejoras Sugeridas",
        suggestions: "Sugerencias",
        step5Label: "Paso 5",
        step5Title: "Agregando Notas",
        step5Desc: "Creando notas con sugerencias en tu frame...",
        reportGenerated: "¬°Notas Agregadas!",
        reportDesc: "Las notas con sugerencias han sido a√±adidas junto a tu frame en el canvas.",
        criteriaEvaluated: "Criterios Evaluados",
        changesApplied: "Notas Creadas",
        back: "Atr√°s",
        next: "Siguiente",
        evaluate: "Evaluar Comportamiento",
        applySuggestions: "Agregar Notas",
        done: "Listo"
      }
    };

    // State
    let currentStep = 1;
    let hasValidSelection = false;
    let selectedCriteria = ['fogg_ability', 'spark_triggers', 'scarcity_urgency', 'social_proof', 'goal_gradient'];
    let analysisData = null;
    let frameName = '';
    let currentLang = 'es';
    let currentTheme = 'light';

    // DOM Elements
    const steps = document.querySelectorAll('.step');
    const progressSteps = document.querySelectorAll('.progress-step');
    const btnNext = document.getElementById('btn-next');
    const btnBack = document.getElementById('btn-back');
    const selectionCard = document.getElementById('selection-card');
    const selectionIcon = document.getElementById('selection-icon');
    const selectionValue = document.getElementById('selection-value');
    const selectionHint = document.getElementById('selection-hint');
    const criteriaCards = document.querySelectorAll('.criterion-card');
    const selectAllBtn = document.getElementById('select-all-btn');
    const contextToggle = document.getElementById('context-toggle');
    const contextContent = document.getElementById('context-content');
    const customContextInput = document.getElementById('custom-context-input');
    const suggestionsContainer = document.getElementById('suggestions-container');
    const themeToggle = document.getElementById('theme-toggle');
    const langBtns = document.querySelectorAll('.lang-btn');

    // Initialize
    function init() {
      parent.postMessage({ pluginMessage: { type: 'init' } }, '*');
      setupEventListeners();
      applyTranslations();
    }

    // Apply translations
    function applyTranslations() {
      const t = translations[currentLang];

      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (t[key]) {
          el.textContent = t[key];
        }
      });

      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        if (t[key]) {
          el.placeholder = t[key];
        }
      });

      updateButtons();
    }

    // Event Listeners
    function setupEventListeners() {
      btnNext.addEventListener('click', handleNext);
      btnBack.addEventListener('click', handleBack);

      // Criteria selection
      criteriaCards.forEach(card => {
        card.addEventListener('click', () => toggleCriterion(card));
      });

      // Select all
      selectAllBtn.addEventListener('click', toggleSelectAll);

      // Custom context toggle
      contextToggle.addEventListener('click', () => {
        contextContent.classList.toggle('open');
        const icon = contextToggle.querySelector('span');
        icon.textContent = contextContent.classList.contains('open') ? '‚àí' : '+';
      });

      // Theme toggle
      themeToggle.addEventListener('click', toggleTheme);

      // Language toggle
      langBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const lang = btn.getAttribute('data-lang');
          setLanguage(lang);
        });
      });
    }

    // Theme toggle
    function toggleTheme() {
      currentTheme = currentTheme === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', currentTheme);
      themeToggle.textContent = currentTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
    }

    // Language toggle
    function setLanguage(lang) {
      currentLang = lang;
      langBtns.forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
      });
      applyTranslations();

      // Update selection hint if needed
      if (hasValidSelection) {
        selectionHint.textContent = translations[currentLang].selectedHint;
      }
    }

    // Step Navigation
    function goToStep(step) {
      currentStep = step;

      // Update step visibility
      steps.forEach((s, i) => {
        s.classList.toggle('active', i + 1 === step);
      });

      // Update progress indicators
      progressSteps.forEach((p, i) => {
        const stepNum = i + 1;
        p.classList.toggle('active', stepNum === step);
        p.classList.toggle('completed', stepNum < step);
      });

      // Update buttons
      updateButtons();
    }

    function updateButtons() {
      const t = translations[currentLang];
      btnBack.style.display = currentStep > 1 && currentStep !== 3 && currentStep !== 5 ? 'flex' : 'none';

      switch (currentStep) {
        case 1:
          btnNext.innerHTML = `<span>${t.next}</span> ‚Üí`;
          btnNext.className = 'btn btn-primary';
          btnNext.disabled = !hasValidSelection;
          btnNext.style.display = 'flex';
          break;
        case 2:
          btnNext.innerHTML = `<span>${t.evaluate}</span>`;
          btnNext.className = 'btn btn-primary';
          btnNext.disabled = selectedCriteria.length === 0;
          btnNext.style.display = 'flex';
          break;
        case 3:
          btnNext.style.display = 'none';
          btnBack.style.display = 'none';
          break;
        case 4:
          btnNext.innerHTML = `<span>${t.applySuggestions}</span>`;
          btnNext.className = 'btn btn-success';
          btnNext.disabled = false;
          btnNext.style.display = 'flex';
          break;
        case 5:
          btnNext.style.display = 'none';
          btnBack.style.display = 'none';
          break;
        case 6:
          btnNext.innerHTML = `<span>${t.done}</span>`;
          btnNext.className = 'btn btn-primary';
          btnNext.disabled = false;
          btnNext.style.display = 'flex';
          break;
      }
    }

    function handleNext() {
      switch (currentStep) {
        case 1:
          goToStep(2);
          break;
        case 2:
          startAnalysis();
          break;
        case 4:
          applySuggestions();
          break;
        case 6:
          parent.postMessage({ pluginMessage: { type: 'close' } }, '*');
          break;
      }
    }

    function handleBack() {
      if (currentStep > 1) {
        goToStep(currentStep - 1);
      }
    }

    // Selection handling
    function updateSelection(data) {
      const t = translations[currentLang];
      hasValidSelection = data.hasValidSelection;
      frameName = data.frameName || '';

      if (hasValidSelection) {
        selectionCard.classList.add('has-selection');
        selectionIcon.textContent = '‚úì';
        selectionValue.textContent = frameName;
        selectionHint.textContent = t.selectedHint;
      } else {
        selectionCard.classList.remove('has-selection');
        selectionIcon.textContent = 'üìê';
        selectionValue.textContent = t.noSelection;
        selectionHint.textContent = t.selectHint;
      }

      if (currentStep === 1) {
        updateButtons();
      }
    }

    // Criteria handling
    function toggleCriterion(card) {
      const criterion = card.dataset.criterion;
      card.classList.toggle('selected');

      if (card.classList.contains('selected')) {
        if (!selectedCriteria.includes(criterion)) {
          selectedCriteria.push(criterion);
        }
      } else {
        selectedCriteria = selectedCriteria.filter(c => c !== criterion);
      }

      updateButtons();
    }

    function toggleSelectAll() {
      const t = translations[currentLang];
      const allSelected = selectedCriteria.length === 5;

      criteriaCards.forEach(card => {
        if (allSelected) {
          card.classList.remove('selected');
        } else {
          card.classList.add('selected');
        }
      });

      if (allSelected) {
        selectedCriteria = [];
      } else {
        selectedCriteria = ['fogg_ability', 'spark_triggers', 'scarcity_urgency', 'social_proof', 'goal_gradient'];
      }

      selectAllBtn.innerHTML = allSelected
        ? `<span>‚úì</span> <span>${t.selectAll}</span>`
        : `<span>‚úó</span> <span>${t.deselectAll}</span>`;
      updateButtons();
    }

    // Analysis
    function startAnalysis() {
      goToStep(3);

      parent.postMessage({
        pluginMessage: {
          type: 'start-analysis',
          criteria: selectedCriteria,
          customContext: customContextInput.value,
          language: currentLang
        }
      }, '*');
    }

    function displayAnalysis(analysis) {
      const t = translations[currentLang];
      analysisData = analysis;

      // Update overall score
      const score = Math.round(analysis.overallScore);
      document.getElementById('score-value').textContent = `${score}%`;
      document.querySelector('.score-circle').style.setProperty('--score', score);

      // Clear and populate suggestions
      suggestionsContainer.innerHTML = '';

      // Group observations by criterion
      const observationsByCriterion = {};
      if (analysis.elementObservations) {
        analysis.elementObservations.forEach(obs => {
          if (!observationsByCriterion[obs.criterion]) {
            observationsByCriterion[obs.criterion] = [];
          }
          observationsByCriterion[obs.criterion].push(obs);
        });
      }

      analysis.recommendations.forEach(rec => {
        const scoreClass = rec.score >= 80 ? 'score-high' : rec.score >= 60 ? 'score-medium' : 'score-low';
        const critObs = observationsByCriterion[rec.criterion] || [];

        // Element-specific observations
        let observationsHTML = '';
        if (critObs.length > 0) {
          const obsItems = critObs.map(obs => {
            const typeIcon = obs.type === 'issue' ? '‚ö†Ô∏è' : 'üí°';
            const elementLabel = obs.elementName && obs.elementName !== 'Frame'
              ? `<span class="obs-element">üìç ${obs.elementName}</span>`
              : '';
            return `<li class="obs-item obs-${obs.type}">${typeIcon} ${elementLabel}<span class="obs-message">${obs.message}</span></li>`;
          }).join('');

          observationsHTML = `
            <div class="element-observations">
              <div class="obs-label">${currentLang === 'es' ? 'üìù Observaciones por elemento:' : 'üìù Element observations:'}</div>
              <ul class="obs-list">${obsItems}</ul>
            </div>
          `;
        }

        const html = `
          <div class="suggestion-card">
            <div class="suggestion-header">
              <span class="suggestion-name">
                ${getCriterionIcon(rec.criterion)} ${rec.name}
              </span>
              <span class="suggestion-score ${scoreClass}">${rec.score}%</span>
            </div>
            ${observationsHTML}
          </div>
        `;

        suggestionsContainer.innerHTML += html;
      });

      goToStep(4);
    }

    function getCriterionIcon(criterion) {
      const icons = {
        fogg_ability: 'üß†',
        spark_triggers: '‚ö°',
        scarcity_urgency: '‚è∞',
        social_proof: 'üë•',
        goal_gradient: 'üìà'
      };
      return icons[criterion] || 'üìã';
    }

    // Apply suggestions
    function applySuggestions() {
      goToStep(5);

      parent.postMessage({
        pluginMessage: { type: 'apply-suggestions' }
      }, '*');
    }

    function showReportComplete(data) {
      // Update stats
      document.getElementById('criteria-count').textContent = selectedCriteria.length;
      document.getElementById('changes-count').textContent = data.notesCount || 0;

      goToStep(6);
    }

    // Message handler
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (!msg) return;

      switch (msg.type) {
        case 'selection-update':
          updateSelection(msg);
          break;
        case 'analysis-complete':
          displayAnalysis(msg.analysis);
          break;
        case 'generating-start':
          goToStep(5);
          break;
        case 'generation-complete':
          showReportComplete(msg);
          break;
        case 'error':
          console.error('Plugin error:', msg.message);
          alert('Error: ' + msg.message);
          goToStep(1);
          break;
      }
    };

    // Start
    init();
  </script>
</body>

</html>